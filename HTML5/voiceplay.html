<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<link rel="stylesheet" type="text/css" href="css/reset.css"/>
		<style type="text/css">
			.player{
				height: 670px;
				width: 1022px;
				border: 1px solid red;
			}
			.top{
				display: block;
			}
			.mid{
				height: 570px;
				width: 100%;
				background:linear-gradient(#D4D3D5,#666,#D4D3D5);
			}
			.mid > div{
				float: left;
				height: 100%;
				width: 50%;
				overflow: hidden;
			}
			.mid .fl img{
				display: block;
				margin: auto;
				position: relative;
			}
			.mid .bar{
				top: 0px;
				z-index: 1;
				-webkit-transform-origin: center top;
				-webkit-transform: rotateX(-70deg);
				transition: all 1s;
			}
			.mid .bar.active{
				-webkit-transform: rotate(0);
			}
			.mid .circle{
				height: 300px;
				width: 300px;
				background: url(player/play_disc.png) center center;
				background-size:100% 100%;
				position: relative;
				top: -40px;
				margin: auto;
				overflow: hidden;
				transition: all 100s;
				-webkit-animation: move 3s infinite linear paused;
			}
			.mid .circle.active{
				-webkit-animation: move 3s infinite linear;
			}
			@keyframes move{
				from{
					-webkit-transform: rotate(0deg);
				}
				to{
					-webkit-transform: rotate(360deg);
				}
			}
			.mid .circle img{
				height: 200px;
				width: 200px;
				border-radius: 50%;
				margin-top: 50px;
			}
			.mid h3{
				margin: 20px 0;
			}
			.foot{
				height: 50px;
				border-top:1px solid #d8d8d8 ;
				background: #F6F6F8;
			}
			.foot li{
				float: left;
			}
			.control{
				width: 208px;
				height: 100%;
				text-align: center;
				/*line-height: 50px;
				height: 50px;*/
			}
			.control span{
				display: inline-block;
				height: 36px;
				width: 36px;
				border-radius: 50%;
				margin: 7px 5px;
				/*background: ;*/
			}
			.control .prev{
				background:#de4035 url(player/play_btn_prev.png) no-repeat center center;
				background-size:100% 100%;
			}
			.control .next{
				background:#de4035 url(player/play_btn_next.png) no-repeat center center;
				background-size:100% 100%;
			}
			.control .play{
				background:#de4035 url(player/play_rdi_btn_play.png) no-repeat center center;
				background-size:100% 100%;
			}
			.drag{
				width: 520px;
				height: 100%;
				line-height: 50px;
			}
			.drag .outer{
				width: 420px;
			}
			.foot .outer{
				display: inline-block;
				height: 6px;
				background:#e7e7e9 ;
				border-radius: 3px;
				position: relative;
				top: -2px;
			}
			.foot .inner{
				width: 0;
				height: 100%;
				background: #E83C3C;
				position: relative;
				border-radius: 3px;
			}
			.foot em{
				display: inline-block;
				height: 14px;
				width: 14px;
				border: 1px solid #D8D8D8;
				border-radius: 50%;
				position: absolute;
				top: -5px;
				left: 0;
				background: #FFF;
			}
			.foot em:before{
				content: '';
				height: 4px;
				width: 4px;
				background:#E83C3C ;
				position: absolute;
				top: 5px;
				left: 5px;
				border-radius: 50%;
			}
			.voice{
				width: 130px;
				line-height: 50px;
				width: 166px;
				text-align: center;
			}
			.voice em{
				left: 45px;
			}
			.voice .outer{
				width: 102px;
			}
			.voice .inner{
				width: 50px;
			}
			.voice span{
				display: inline-block;
				width: 20px;
				height: 16px;
				background: url(img/audio.png) no-repeat center center;
				background-size:100% 100% ;
				position: relative;
				top: 3px;
			}
			.foot-img,.foot-img img{
				width: 126px;
				margin-top: 4px;
			}
			.lrc{
				height: 400px;
				/*border: 1px solid red;*/
				margin-top: 20px;
				overflow: hidden;
			}
			.lrc ul{
				overflow: hidden;
			}
			.lrc li{
				line-height: 40px;
			}
			.lrc li.active{
				color: white;
			}
			
		</style>
	</head>
	<body>
		<div class="player">
			<audio src="img/moon.mp3"></audio>
			<img class="top" src="img/11.png"/>
			<div class="mid">
				<div class="fl">
					<img class="bar" src="img/audio2.png"/>
					<div class="circle">
						<img src="img/3.jpg"/>
					</div>
				</div>
				<div class="fr">
					<h3>青花瓷</h3>
					<div class="info">
						专辑：<span>我很忙</span>
						歌手：<span>周杰伦</span>
						来源：<span>我很忙</span>
					</div>
					<div class="lrc">
						<ul>
						</ul>
					</div>
				</div>
			</div>
			<div class="foot">
				<ul>
					<li class="control">
						<span class="prev"></span>
						<span class="play" state='true'></span>
						<span class="next"></span>
					</li>
					<li class="drag">
						<span>00:00</span>
						<div class="outer">
							<div class="inner">
								<em></em>
							</div>
						</div>
						<span>00:00</span>
					</li>
					<li class="voice">
						<span></span>
						<div class="outer">
							<div class="inner">
								<em></em>
							</div>
						</div>
					</li>
					<li class="foot-img">
						<img src="img/111.png"/>
					</li>
				</ul>
			</div>
		</div>
	</body>
	<script type="text/javascript" src="js/jquery-3.2.1.min.js" ></script>
	<script type="text/javascript" src="js/song.js" ></script>
	<script type="text/javascript">
		var oAudio=$('audio').get(0);
		var num=0;
		function changeMusic(a){
			var str='';
				for(attr in song[a].lrc){
				str+='<li time='+attr+'>'+song[a].lrc[attr]+'</li>'
			}
			$('.lrc ul').html(str);
		}
		changeMusic(num);
		var allT=oAudio.duration;
		var allW=$('.drag .outer').width();
		var allTT=$('.voice .outer').width();
		var audioVolume=oAudio.volume;
//		console.log(audioVolume)
		var timer=null;
		$('.drag span').eq(1).html(fn(allT));
		$('.play').click(function(){
			if($('.play').attr('state')=='true'){
				oAudio.play();
				$('.mid .bar').addClass('active');
				$('.mid .circle').addClass('active');
				$('.play').attr('state','false');
				$('.play').css('background-image','url(player/play_rdi_btn_pause.png)');
				setInterval(function(){
					var currentT=oAudio.currentTime;
					$('.drag span').eq(0).html(fn(currentT));
					changeLrc(currentT);
				},1000)
				
			}else{
				clearInterval(timer);
				oAudio.pause();
				$('.mid .bar').removeClass('active');
				$('.mid .circle').removeClass('active');
				$('.play').attr('state','true');
				$('.play').css('background-image','url(player/play_rdi_btn_play.png)');
			}
		})
		$('.drag em').mousedown(function(ev){
			var beginX=ev.clientX;
			var beginW=$('.drag .inner').width();
			var beginL=$('.drag em').position().left;
			$(document).mousemove(function(ev){
				var addX=ev.clientX-beginX;
				var W=beginW+addX;
				var T=beginL+addX
				if(W<=0){
					W=0;
				}else if(W>=allW){
					W=allW;
				}
				if(T<=0){
					T=0;
				}else if(T>=allW){
					T=allW-10;
				}
				$('.drag .inner').width(W+'px');
				$('.drag em').css('left',T+'px');
				var currentT=W/allW*allT;
				$('.drag span').eq(0).html(fn(currentT));
				oAudio.currentTime=currentT;
				changeLrc(currentT);
			})
			$(document).mouseup(function(){
				$(this).off('mousemove')
			}) 
			return false;
		})
		var control=true;
		$('.voice span').click(function(){
			if(control){
				$(this).css('background-image','url(img/audio1.png)')
				$('.voice .inner').css('width',0);
				$('.voice em').css('left',0)
				oAudio.volume=0;
				control=false;
			}else{
				$(this).css('background-image','url(img/audio.png)');
				$('.voice .inner').css('width',50+'px');
				$('.voice em').css('left',45+'px')
				oAudio.volume=0.4;
				control=true;
			}
		})
		$('.voice em').mousedown(function(ev){
			var beginX=ev.clientX;
			var beginW=$('.voice .inner').width();
			var beginL=$('.voice em').position().left;
			$(document).mousemove(function(ev){
				var addX=ev.clientX-beginX;
				var W=beginW+addX;
				var T=beginL+addX
				if(W<=0){
					W=0;
				}else if(W>=allTT){
					W=allTT;
				}
				if(T<=0){
					T=0;
				}else if(T>=allTT){
					T=allTT-10;
				}
				$('.voice .inner').width(W+'px');
				$('.voice em').css('left',T+'px');
				oAudio.volume=(W/allTT*audioVolume);
				console.log(oAudio.volume)
			})
			$(document).mouseup(function(){
				$(this).off('mousemove')
			}) 
			return false;	
		})
		$('.next').click(function(){
			num++;
			oAudio.src=song[num].audio;
			oAudio.load();
			oAudio.play();
			changeMusic(num);
			$('.mid .bar').addClass('active');
			$('.mid .circle').addClass('active');
			setInterval(function(){
					var currentT=oAudio.currentTime;
					$('.drag span').eq(0).html(fn(currentT));
					changeLrc(currentT);
			},1000)
		})
		function fn(b){
			var m=doubleFn(Math.floor(b/60));
			var s=doubleFn(Math.floor(b%60));
			return m+":"+s;
		}
		function doubleFn(n){
				n<10 ? n='0'+n : n;
				return n;
		}
		function changeLrc(n){
			$('.lrc li').each(function(i,elem){  
				if($(elem).attr('time')==fn(n)){ 
					var _index=$(elem).index();  
					$('.lrc li').removeClass('active');
					$(elem).addClass('active'); 
					$('.lrc ul').animate({'margin-top':-40*_index+'px'},500);
				}
			})
		}
	</script>
</html>
